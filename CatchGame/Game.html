<!DOCTYPE html>
<html>
	<head>
		<title>Catch Game</title>
	</head>
	
	<body style="background-color:#CCCCCC">
	<h1>Catch as many bees as posible</h1>
	<canvas id="can" width="900" height="600" style="border:1px solid #000000;" tabindex="1"></canvas>
	<!--<form>
		<input type="button" value="Random Triangle" onclick="randTria();">
		<input type="button" value="Set own Triangle" onclick="setTria();">
	</form>-->
	
	<script>
	
	var score = 0;
	var keyMap = {};
	var canvas, height, width, target, ctx;
	var background = new Image();
	var player = new Image();
	var bee = new Image();
	var speed = 10;
	var playerPos = new Array(2);
	var beePos;
	
	
	
	
	canvas = document.getElementById("can");
	height = canvas.height;
	width = canvas.width;
	target;
	ctx = canvas.getContext("2d");
	ctx.font = "20px Comic Sans MS";
	playerPos[0] = 10;
	playerPos[1] = height/2;
	var playerBoundigBox = {radius: 20, x: (10 +23), y:(height/2 +27)};
	beePos = getRandomPoint();
	
	canvas.addEventListener("keydown", function(e) {
			e = e || event;
			keyMap[e.keyCode] = e.type == 'keydown';
			//console.log(keyMap);
	});
	
	canvas.addEventListener("keyup", function(e) {
			e = e || event;
			keyMap[e.keyCode] = e.type == 'keydown';
	});
	draw();
	
	background.onload = function()
	{
		ctx.drawImage(background, 0, 0, width, height);
	}
	background.src = "background.jpg";
	
	player.onload = function()
	{
		ctx.drawImage(player, 0, 0, 30, 30);
	}
	player.src = "vogel.png";
	
	bee.onload = function()
	{
		ctx.drawImage(bee, 0, 0, 30, 30);
	}
	bee.src = "Biene.png";
	
		
	function draw() 
	{
		//Clear Canvas
		ctx.clearRect(0, 0, width, height);
		//Start from back to front to draw Elements
		ctx.drawImage(background, 0, 0, width, height);
		
		//Score
		ctx.fillText("Score: "+score, 10, 25);
		
		//Calc PlayerPosition
		if(keyMap[68])
		{
			if(playerPos[0] > width - 50)
			{} else 
			{
				playerPos[0] += speed;
				playerBoundigBox.x += speed;
			}
		} 
		if(keyMap[65])
		{
			if(playerPos[0] < 10)
			{} else 
			{
				playerPos[0] -= speed;
				playerBoundigBox.x -= speed;
			}
		}
		if(keyMap[87])
		{
			if(playerPos[1] < 10)
			{} else 
			{
				playerPos[1] -= speed;
				playerBoundigBox.y -= speed;
			}
		}
		if(keyMap[83])
		{
			if(playerPos[1] > height - 50)
			{} else 
			{
				playerPos[1] += speed;
				playerBoundigBox.y += speed;
			}
		}
		
		//show Player
		//Here needs to be checked if the image shoud rotate 
		ctx.drawImage(player, playerPos[0], playerPos[1], 50, 50);

		//Calculating Collision
		var dx = playerBoundigBox.x - beePos[0];
		var dy = playerBoundigBox.y - beePos[1];
		var distance = Math.sqrt(dx * dx + dy * dy);
		
		if(distance < playerBoundigBox.radius + 19)
		{
			score++;
			beePos = getRandomPoint();
		}
		
		moveBee();
		
		//show Bee
		ctx.drawImage(bee, beePos[0], beePos[1], 50, 50);
		
		window.requestAnimationFrame(draw);
	}
	
	var direction;
	var length = 0;
	var speedBee;
	
	function moveBee()
	{
		if(length == 0)
		{
			length = Math.trunc(Math.random() * 20 + 1);
			//console.log("len", length);
			direction = Math.ceil(Math.random() * 8);
			//console.log("dir", direction);
			speedBee = Math.random() * 20;
			//console.log("sped", speedBee);
		} else {
			if(direction == 1)
			{
				//Move horizontal
				if(beePos[0] > width - 50)
				{
					direction = 3;
				} else 
				{
					beePos[0] += speedBee;
				}
				
			} else if(direction == 2)
			{
				//Move vertical
				if(beePos[1] > height - 50)
				{
					//console.log("true?");
					direction = 4;
				} else 
				{
					beePos[1] += speedBee;
				}
				
			} else if(direction == 3)
			{
				//Move vertical
				if( beePos[0] < 10)
				{
					//console.log("true?");
					direction = 1;
				} else 
				{
					beePos[0] -= speedBee;
				}
				
			} else if(direction == 4)
			{
				//Move vertical
				if( beePos[1] < 10)
				{
					//console.log("true?");
					direction = 2;
				} else 
				{
					beePos[1] -= speedBee;
				}
				
			} else if(direction == 5)
			{
				//Move horizontal
				if(beePos[0] > width - 50 || beePos[1] < 10)
				{
					direction = 3;
				} else 
				{
					beePos[0] += speedBee;
					beePos[1] -= speedBee;
				}
				
			} else if(direction == 6)
			{
				//Move horizontal
				if(beePos[0] > width - 50 || beePos[1] > height - 50)
				{
					direction = 3;
				} else 
				{
					beePos[0] += speedBee;
					beePos[1] += speedBee;
				}
				
			} else if(direction == 7)
			{
				//Move horizontal
				if(beePos[0] < 10 || beePos[1] > height - 50)
				{
					direction = 3;
				} else 
				{
					beePos[0] -= speedBee;
					beePos[1] += speedBee;
				}
				
			} else if(direction == 8)
			{
				//Move horizontal
				if(beePos[0] < 10 || beePos[1] < 10)
				{
					direction = 3;
				} else 
				{
					beePos[0] -= speedBee;
					beePos[1] -= speedBee;
				}
				
			} 
			length--;
			//console.log("BeePos: ",beePos);
		}
	}
	
	function getRandomPoint()
	{
		var p = [Math.random() * (width-20) + 10, Math.random() * (height-20) + 10];
		return p;
	}
	
	</script>
	
	
	</body>

</html>